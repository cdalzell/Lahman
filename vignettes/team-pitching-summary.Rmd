---
title: "Team pitching summaries"
author: "Martin Monkman"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Run Scoring Trends}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Team pitching summaries: applying the principles of tidy evaluation


This vignette demonstrates how to call a function from within a `dplyr` pipe (using quasiquotation and quosures using `quo`) to count the number of pitchers used by each team in a single season.

First, we load the necessary packages: `Lahman` (containing the baseball data) and the data carpentry package `dplyr` (version 0.7.0 or higher):


```{r Setup, message=FALSE}

# package load 
library(Lahman)
library(dplyr)

```

#### Read and summarize the data

For this example, we'll use the data table `Pitching` in the Lahman database. This table contains a list of the season record for each pitcher; note that if a pitcher was switched teams mid-season (due to a trade, etc.) he will have two records, one for each team. The variable `stint` shows the order of appearance on each team.

(A parallel table `Batting` has a similar structure.)


Once the table is loaded, the data are filtered and summarized using dplyr.

 - filters to select 2016,
 
 - a new variable `GR` (for Games as a Relief pitcher) is created using the `mutate()` function.  The number of relief appearances is calculated by subtracting the number of games started by the pitcher (`GS`) from the total number of games they appeared in (`G`).

For the 2016 season, there were a total of 824 records.


```{r, message=FALSE}


data("Pitching")

Pitching_season <- Pitching %>%
  filter(yearID == "2016")

Pitching_season <- Pitching_season %>%
  mutate(GR = (G - GS))


View(Pitching_season)


```

#### Summary table

The next step is to create a summary table that shows the number of pitchers used by each team in the 2016 season. This is accomplished using the `group_by()` function.

```{r, message=FALSE}

team_pitching <- Pitching_season %>%
  group_by(teamID) %>%
  summarise(GS_total = sum(GS), 
            GR_total = sum(GR))

View(team_pitching)

```





***


#### Further reading:

* [dplyr 0.7.0](https://blog.rstudio.com/2017/06/13/dplyr-0-7-0/) (2017-06-13)

* [Programming with dplyr](http://dplyr.tidyverse.org/articles/programming.html)


**tidy evaluation**

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Tidy eval in ~5 minutes: <a href="https://t.co/mKBA7288jn">https://t.co/mKBA7288jn</a> â€” my latest attempt to cover the big ideas of tidy evaluation before you dive into the details <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a></p>&mdash; Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/963147362410508288?ref_src=twsrc%5Etfw">February 12, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


* [tidyeval resource roundup](https://maraaverick.rbind.io/2017/08/tidyeval-resource-roundup/) (2017-08-26)

* [Tidy evaluation](https://cran.r-project.org/web/packages/rlang/vignettes/tidy-evaluation.html)

* [Non-standard evaluation, how tidy eval builds on base R](https://edwinth.github.io/blog/nse/)


Bruno Rodrigues:

* [Functional programming and unit testing for data munging with R](https://b-rodrigues.github.io/fput/) (2017-08-25)

* [Why I find tidyeval useful](http://www.brodrigues.co/blog/2017-08-27-why_tidyeval/) (2017-08-27)

* [Lesser known dplyr 0.7* tricks](http://www.brodrigues.co/blog/2017-06-19-dplyr-0-70-tutorial/)


